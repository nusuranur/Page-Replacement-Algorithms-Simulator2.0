<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OS LAB SIMULATOR</title>
    <link rel="stylesheet" href="css/bootstrap.css" type="text/css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@300&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/animate.css" type="text/css">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <style>
        table,
        tr,
        td {
            border: 2px solid black !important;
        }
        #table {
            width: 80vw;
            margin: 15px;
        }
        #summary {
            display: flex;
            justify-content: space-around;
            align-items: center;
            flex-wrap: wrap;
            flex-direction: row;
        }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0"
        crossorigin="anonymous"></script>
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">

    <link rel="stylesheet" type="text/css" href="css/style.css">
    <link rel="shortcut icon" type="image/png" href="images/website_logo1.png">
</head>

<body>

    <nav class="navbar sticky-top navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="pagereplacement_index.html">
                <div class="hover-border">PAGE REPLACEMENT</div>
            </a>
            <div class="divider"></div>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="index.html">
                            <div class="hover-border">HOME</div>
                        </a>
                    </li>

                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            ALGORITHMS
                        </a>
                        <ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="navbarDropdown">
                            <li><a class="dropdown-item" href="./fifo.html">FIFO</a></li>
                            <li><a class="dropdown-item" href="./lifo.html">LIFO</a></li>
                            <li><a class="dropdown-item" href="./lru.html">LRU</a></li>
                            <li><a class="dropdown-item" href="./optimal.html">OPTIMAL</a></li>
                        </ul>
                    </li>
                </ul>

                <div class="d-flex position-relative">
                    <div class="dropdown">
                        <input id="search-input" class="form-control me-2 dropdown-toggle" data-bs-toggle="dropdown"
                            aria-expanded="false" placeholder="Search algorithms..." aria-label="Search">
                        <ul id="suggestions" class="dropdown-menu dropdown-menu-dark" aria-labelledby="search-input"></ul>
                        <button id="search-button" class="btn btn-outline-light position-absolute" type="button"
                            style="right: 10px; top: 50%; transform: translateY(-50%); border: none; background: none; padding: 0;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                                class="bi bi-search" viewBox="0 0 16 16">
                                <path
                                    d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 1 1 11 0z" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </nav>
    <div class="mid-block">
        <div class="mid-heading-wrapper">
            <div class="mid-heading">
                <h1 class="hover-border">LAST IN FIRST OUT</h1>
            </div>
        </div>
        <div class="mid-cards">
            <div class="card text-white bg-success mb-3" style="max-width: 24rem;">
                <div class="card-header bg-success" style="color:black;font-size: 2rem;font-weight:bold ;">LIFO</div>
                <div class="card-body" style="overflow-y: scroll;">
                    <p class="card-text">Stands for "Last In, First Out." LIFO is an algorithm which follows processing
                        of data in which the last items entered are the first to be removed. Thus the new element is
                        inserted above the existing element. The operating system keeps track of all pages in the memory
                        in a form of stack, the newest page is on the top of the stack. When a page needs to be
                        replaced, page on the top of the stack is selected for removal first.</p><br>
                    <div class="card-header bg-success" style="font-size: 1.5rem; padding: 0; border: 0;">Advantages</div>
                    <p class="card-text">
                    <ol>
                        <li>
                            LIFO makes it easier to replace the newest page that arrived at last in the main memory.
                        </li><br>
                        <li>
                            Simple data structures are used.
                        </li><br>
                        <li>
                            Highly efficient.
                        </li><br>
                    </ol>
                    </p>
                    <div class="card-header bg-success" style="font-size: 1.5rem; padding: 0; border: 0;">Disadvantages
                    </div>
                    <p class="card-text">
                    <ol>
                        <li>
                            As LIFO follows last in first out so it makes it time consuming to execute tasks which were
                            scheduled first.
                    </ol>
                    </p>
                </div>
            </div>

            <div class="card text-white bg-success mb-3" style="max-width: 24rem;">
                <div class="card-header" style="color:black;font-size: 2rem;font-weight:bold ;">ALGORITHM</div>
                <div class="card-body">
                    <p class="card-text">
                    <ol>
                        <li>
                            LIFO algorithm can be implemented by creating a stack to store all pages in memory.
                        </li><br>
                        <li>
                            Now maintain a stack of all pages currently in main memory and remove the page that is at
                            the top of the stack at the linked list.
                        </li><br>
                    </ol>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div class="last-block">
        <div class="mid-heading-wrapper">
            <div class="mid-heading">
                <h1 class="hover-border">IMPLEMENTATION</h1>
            </div>
        </div>
        <div class="divider" style="height: 10vh;"></div>
        <div id="algo">
            <div class="container"
                style="width: 85vw; height: fit-content; margin-bottom: 10px; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                <div
                    style="display: flex; flex-direction: row; align-items: center; justify-content: center; flex-wrap: wrap;">
                    <div
                        style="margin: 10px; width: fit-content; display: flex; justify-content: center; align-items: center;">
                        <strong>Reference String:</strong>
                        <input class="input" type="text" style="width: 55%; min-width: 225px; margin: 5px;" id="input">
                    </div>
                    <div style="margin: 10px; width: fit-content">
                        <strong>Frames:</strong>
                        <input class="input" type="number" id="frames" style="width: 30%; min-width: 50px; margin: 5px;"
                            min="1" max="10">
                    </div>
                </div>
                <button id="submit" type="button" class="btn btn-dark last_button input"
                    style="margin: 10px; min-width: 80px;">Submit</button>
            </div>
            <div style="margin: 10px; width: fit-content;">
                <br>
                <table id="table" class="container text-center"></table>
                <br>
                <div id="summary" class="d-flex justify-content-around font-weight-bold text-uppercase"> </div>
            </div>
        </div>
    </div>
    <br>
    <br>
    <br>
    <script src="js/search.js"></script>
    <script>
        // Define a class called lifo to simulate LIFO (Last In First Out) page replacement
        class lifo {
            constructor(capacity) {
                this.capacity = capacity;       // Total number of frames available
                this.pageFaults = 0;            // Counter for page faults (misses)
                this.pageHits = 0;              // Counter for page hits
                this.searchIndex = -1;          // Index to check if a page is already in frame
                this.frames = [];               // Array to store current pages in frames
            }

            // Method to process a page reference
            refer(token) {
                // Check if the page is already in frames
                this.searchIndex = this.frames.indexOf(token);

                if (this.searchIndex !== -1) {
                    // If found (HIT), increase hit counter
                    this.pageHits++;
                } else {
                    // If not found (MISS), increase fault counter
                    this.pageFaults++;

                    // If frame is full, remove the last inserted page (LIFO logic)
                    if (this.capacity === this.frames.length) {
                        this.frames.pop();
                    }

                    // Insert the new page into the frame
                    this.frames.push(token);
                }
            }
        }

        // Add event listener to the submit button, triggers the LIFO function when clicked
        document.getElementById("submit").addEventListener("click", function() {
            LIFO();
        });

        // Main function to simulate LIFO page replacement
        function LIFO() {
            console.log("LIFO function triggered");
            // Get user input and split into page reference array
            let res = document.getElementById("input").value.trim().split(/\s+/);
            let frames = parseInt(document.getElementById("frames").value);
            let ref = [];

            // Clean the input to remove extra spaces
            for (let i = 0; i < res.length; i++) {
                if (res[i] !== "" && !isNaN(res[i])) {
                    ref.push(parseInt(res[i]));
                }
            }

            if (ref.length === 0 || isNaN(frames) || frames <= 0) {
                alert("Please enter a valid reference string and number of frames.");
                return;
            }

            console.log("Reference String:", ref, "Frames:", frames);

            // Create table layout for visualization
            createTable("table", frames, ref);

            // Create a LIFO simulation object
            let obj = new lifo(frames);

            // Iterate over each reference string
            for (let i = 0; i < ref.length; i++) {
                obj.refer(ref[i]); // Process the current page reference
                console.log(`Processing ref[${i}]: ${ref[i]}, Frames:`, obj.frames);

                // Fill the corresponding column in the table
                fillcol("table", i + 1, obj.frames, frames, obj.searchIndex);
            }

            // Display the summary result (hits, misses, ratios)
            summary('summary', obj.pageFaults, obj.pageHits + obj.pageFaults, frames);
            console.log("Summary - Hits:", obj.pageHits, "Faults:", obj.pageFaults);
        }

        // Fill a column in the result table with frame values and HIT/MISS status
        function fillcol(tablename, col, objframes, n, searchindex) {
            console.log(`Filling column ${col}, Frames:`, objframes);
            // Ensure the table has enough rows
            let table = document.getElementById(tablename);
            while (table.rows.length <= n) {
                let row = table.insertRow();
                for (let j = 0; j <= objframes.length + 1; j++) {
                    row.insertCell();
                }
            }

            // Fill each frame cell in the current column
            for (let i = 0; i < objframes.length; i++) {
                let cell = document.getElementById(tablename + (i + 1) + '' + col) || table.rows[i + 1].cells[col];
                if (cell) cell.innerHTML = objframes[i] !== undefined ? objframes[i] : "";
            }

            // Move to the "Status" row (last row)
            let statusRow = n + 1;
            let cell = document.getElementById(tablename + statusRow + '' + col) || table.rows[statusRow].cells[col];
            if (cell) {
                if (searchindex === -1) {
                    cell.innerHTML = "MISS";
                    cell.classList.remove("bg-success", "text-white");
                    cell.classList.add("bg-danger", "text-white");
                } else {
                    cell.innerHTML = "HIT";
                    cell.classList.remove("bg-danger", "text-white");
                    cell.classList.add("bg-success", "text-white");
                    // Highlight the HIT page in green
                    let hitCell = document.getElementById(tablename + (searchindex + 1) + '' + col) || table.rows[searchindex + 1].cells[col];
                    if (hitCell) hitCell.classList.add("bg-success", "text-white");
                }
            }
        }

        // Create a visual table to show the reference string, frames, and HIT/MISS status
        function createTable(tablename, frames, ref) {
            console.log("Creating table for", tablename, "with", frames, "frames and", ref, "references");
            let table = document.getElementById(tablename);
            table.innerHTML = ""; // Clear any previous table content

            // Create the top header row with reference string
            let headerRow = table.insertRow();
            let headerCell = headerRow.insertCell();
            headerCell.id = tablename + '00';
            headerCell.innerHTML = "Reference";
            headerCell.classList.add("font-weight-bold");
            for (let i = 0; i < ref.length; i++) {
                let cell = headerRow.insertCell();
                cell.id = tablename + '0' + (i + 1);
                cell.innerHTML = ref[i];
            }

            // Create rows for each frame
            for (let i = 0; i < frames; i++) {
                let row = table.insertRow();
                let frameCell = row.insertCell();
                frameCell.id = tablename + (i + 1) + '0';
                frameCell.innerHTML = "Frame " + (i + 1);
                frameCell.classList.add("font-weight-bold");
                for (let j = 0; j < ref.length; j++) {
                    let cell = row.insertCell();
                    cell.id = tablename + (i + 1) + (j + 1);
                }
            }

            // Add the final row for showing HIT/MISS status
            let statusRow = table.insertRow();
            let statusCell = statusRow.insertCell();
            statusCell.id = tablename + (frames + 1) + '0';
            statusCell.innerHTML = "Status";
            statusCell.classList.add("font-weight-bold");
            for (let j = 0; j < ref.length; j++) {
                let cell = statusRow.insertCell();
                cell.id = tablename + (frames + 1) + (j + 1);
            }
        }

        // Display a summary of total pages, frames, hits, faults, and hit/miss ratios
        function summary(id, pagefaults, pages, frames) {
            console.log("Generating summary for", id, "with faults:", pagefaults, "pages:", pages, "frames:", frames);
            let summary = "";
            let missratio = (pagefaults / pages).toPrecision(2);     // Calculate miss ratio
            let hitratio = (1 - missratio).toPrecision(2);            // Calculate hit ratio

            // Create summary info
            summary += `<div>Pages: ${pages}</div>`;
            summary += `<div>Frames: ${frames}</div>`;
            summary += `<div>Hits: ${pages - pagefaults}</div>`;
            summary += `<div>Faults: ${pagefaults}</div>`;
            summary += `<div>Hit Ratio: ${hitratio}</div>`;
            summary += `<div>Miss Ratio: ${missratio}</div>`;

            // Display summary in the summary element
            document.getElementById(id).innerHTML = summary;
        }

        // Hide/show navigation bar based on scroll direction
        window.addEventListener('wheel', (e) => {
            if (e.deltaY > 0) {
                // Scroll down: hide navbar with animation
                document.getElementsByClassName('navbar')[0].classList.add('animate__slideOutUp');
                setTimeout(() => {
                    document.getElementsByClassName('navbar')[0].style.display = 'none';
                    document.getElementsByClassName('navbar')[0].classList.remove('animate__slideOutUp');
                }, 100);
            } else {
                // Scroll up: show navbar again with animation
                if (document.getElementsByClassName('navbar')[0].style.display === 'none') {
                    document.getElementsByClassName('navbar')[0].classList.add('animate__slideInDown');
                    setTimeout(() => {
                        document.getElementsByClassName('navbar')[0].style.display = 'block';
                    }, 50);
                    setTimeout(() => {
                        document.getElementsByClassName('navbar')[0].classList.remove('animate__slideInDown');
                    }, 500);
                }
            }
        });
    </script>
</body>

</html>